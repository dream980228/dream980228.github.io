(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{485:function(s,a,t){"use strict";t.r(a);var e=t(2),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"起因"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#起因"}},[s._v("#")]),s._v(" 起因")]),s._v(" "),t("p",[s._v("最近知道了几个关键词主从复制、读写分离、mysql集群。起因是我在做项目的时候，有的场景需要多写一行代码，作用是强制读取主库，起初也知道些许读写分离的思想，但是我好奇的是如何实现的强制读取主库，但是看了代码也没有发现是如何实现的。之后在网上搜索相关的知识，主从复制、读写分离、mysql集群等一股脑的都冒出来了，我开始了如下的实验之旅。")]),s._v(" "),t("h2",{attrs:{id:"实验环境说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验环境说明"}},[s._v("#")]),s._v(" 实验环境说明")]),s._v(" "),t("p",[s._v("我使用的是一个免费、在线的docker容器"),t("a",{attrs:{href:"https://labs.play-with-docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("play-with-docker"),t("OutboundLink")],1),s._v("，只需要在"),t("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Docker Hub"),t("OutboundLink")],1),s._v("注册一个账号就可以使用。")]),s._v(" "),t("p",[s._v("mysql镜像版本为mysql:latest，实际上对应的版本为8.0.25。")]),s._v(" "),t("p",[s._v("需要一定的Linux、docker命令基础。")]),s._v(" "),t("h2",{attrs:{id:"涉及的操作命令示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#涉及的操作命令示例"}},[s._v("#")]),s._v(" 涉及的操作命令示例")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看本地镜像")]),s._v("\ndocker images\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉取MySQL镜像")]),s._v("\ndocker pull xxxxx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行镜像")]),s._v("\ndocker run -itd -name mysql-xxxxx -p xxxx:xxxx -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxxxx mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器中")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 xxxxx "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器的网络地址")]),s._v("\ndocker inspect xxxxx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器列表")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\n")])])]),t("h2",{attrs:{id:"拉取mysql镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取mysql镜像"}},[s._v("#")]),s._v(" 拉取MySQL镜像")]),s._v(" "),t("p",[s._v("默认这种方式拉取的是最新的镜像文件，如果要拉取特定的版本则需要mysql在后面加上版本号，如mysql:5.7。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#拉取mysql镜像")]),s._v("\ndocker pull mysql\n")])])]),t("h2",{attrs:{id:"主库容器操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主库容器操作"}},[s._v("#")]),s._v(" 主库容器操作")]),s._v(" "),t("h3",{attrs:{id:"运行主库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行主库"}},[s._v("#")]),s._v(" 运行主库")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -itd --name mysql-master -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3307")]),s._v(":3306 mysql\n")])])]),t("h3",{attrs:{id:"配置主库my-cnf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置主库my-cnf"}},[s._v("#")]),s._v(" 配置主库my.cnf")]),s._v(" "),t("p",[s._v("首先需要查看一下主库的容器ID")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\nCONTAINER ID   IMAGE     COMMAND                  CREATED              STATUS              PORTS                               NAMES\n03b4cbdd57a6   mysql     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   About a minute ago   Up About a minute   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33060")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3307-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp   mysql-master\n")])])]),t("p",[s._v("CONTAINER ID便是容器ID，进入到容器的内部。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 03b4cbdd57a6 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])])]),t("p",[s._v("此时，便进入到了容器的内部，这是一个非常干净的环境，类似于vi/vim需要手动安装。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n")])])]),t("p",[s._v("然后使用Vim进入编辑器，将以下内容填写到相应的位置并保存。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/my.cnf\n")])])]),t("div",{staticClass:"language-cnf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\nserver-id=1\nlog-bin=master-bin\n")])])]),t("p",[s._v("修改完MySQL的配置文件，则需要将MySQL重启后才可以生效，但是常规的MySQL的重启的命令不可以，只好将主库容器重启，然后再进入到容器中。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启容器")]),s._v("\ndocker restart 03b4cbdd57a6\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#再次进入到容器中")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 03b4cbdd57a6 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])])]),t("h3",{attrs:{id:"数据库内部操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库内部操作"}},[s._v("#")]),s._v(" 数据库内部操作")]),s._v(" "),t("p",[s._v("接下来的操作需要进入到MySQL的内部进行操作。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入数据库")]),s._v("\nmysql -uroot -p123456\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建用户slave用户")]),s._v("\ncreate user "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#授权")]),s._v("\ngrant replication slave,replication client on *.* to "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#防止密码简单报错")]),s._v("\nalter user "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" identified with mysql_native_password by "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"查看配置的结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看配置的结果"}},[s._v("#")]),s._v(" 查看配置的结果")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器的运行状态")]),s._v("\nshow master status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("正常出现的结果为，需要记住File和Position，此后，退出数据库，退出容器，不要再做任何操作。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------+----------+--------------+------------------+-------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("File")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Position "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Do_DB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Ignore_DB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Executed_Gtid_Set "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------+----------+--------------+------------------+-------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("996")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------+----------+--------------+------------------+-------------------+")]),s._v("\n")])])]),t("p",[s._v("退出容器后，需要查看主库的网络ip，172.17.0.2便是。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker inspect 03b4cbdd57a6 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" IPAddress\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SecondaryIPAddresses"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.2"')]),s._v(",\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"172.17.0.2"')]),s._v(",\n")])])]),t("h2",{attrs:{id:"从库容器操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从库容器操作"}},[s._v("#")]),s._v(" 从库容器操作")]),s._v(" "),t("h3",{attrs:{id:"运行从库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行从库"}},[s._v("#")]),s._v(" 运行从库")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -itd --name mysql-slave-1 -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3308")]),s._v(":3306 mysql\n")])])]),t("h3",{attrs:{id:"配置从库my-cnf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置从库my-cnf"}},[s._v("#")]),s._v(" 配置从库my.cnf")]),s._v(" "),t("p",[s._v("同样需要查看一下从库的容器ID")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\nCONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                               NAMES\n120fb0493866   mysql     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" seconds   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33060")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3308-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp   mysql-slave-1\n03b4cbdd57a6   mysql     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v(" minutes ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" minutes   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33060")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3307-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp   mysql-master\n")])])]),t("p",[s._v("进入到从库的内部")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 120fb0493866 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])])]),t("p",[s._v("安装vim，编辑从库my.cnf")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装vim")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#编辑my.cnf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/mysql/my.cnf\n")])])]),t("p",[s._v("填写如下内容")]),s._v(" "),t("div",{staticClass:"language-cnf extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("[mysqld]\nserver-id=2\nlog-bin=slave-1-bin\nbinlog_ignore_db=information_schema\nbinlog_ignore_db=performation_schema\nbinlog_ignore_db=mysql\nbinlog_ignore_db=sys\nbinlog-format=MIXED\n")])])]),t("p",[s._v("退出容器，将容器重启。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启容器")]),s._v("\ndocker restart 120fb0493866\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#再次进入到容器中")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 120fb0493866 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])])]),t("h3",{attrs:{id:"数据库内部操作-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库内部操作-2"}},[s._v("#")]),s._v(" 数据库内部操作")]),s._v(" "),t("p",[s._v("进入到数据库中")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("mysql -uroot -p123456\n")])])]),t("p",[s._v("配置同步主库")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("change master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.17.0.2'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master-bin.000001'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("996")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_connect_retry"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("table",[t("thead",[t("tr",[t("th",[s._v("名称")]),s._v(" "),t("th",[s._v("说明")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("master_host")]),s._v(" "),t("td",[s._v("主库的网络地址")])]),s._v(" "),t("tr",[t("td",[s._v("master_port")]),s._v(" "),t("td",[s._v("数据库端口，而不是外部端口")])]),s._v(" "),t("tr",[t("td",[s._v("master_user")]),s._v(" "),t("td",[s._v("同步用户中间人")])]),s._v(" "),t("tr",[t("td",[s._v("master_password")]),s._v(" "),t("td",[s._v("验证密码")])]),s._v(" "),t("tr",[t("td",[s._v("master_log_file")]),s._v(" "),t("td",[s._v("同步的日志文件")])]),s._v(" "),t("tr",[t("td",[s._v("master_log_pos")]),s._v(" "),t("td",[s._v("同步的日志文件位置")])]),s._v(" "),t("tr",[t("td",[s._v("master_connect_retry")]),s._v(" "),t("td",[s._v("重连次数")])])])]),s._v(" "),t("h3",{attrs:{id:"查看配置结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看配置结果"}},[s._v("#")]),s._v(" 查看配置结果")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启同步")]),s._v("\nstart slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看是否连接正常")]),s._v("\nshow slave status "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("G\n")])])]),t("p",[s._v("Slave_IO_Running和Slave_SQL_Running同为Yes就是正常的。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n               Slave_IO_State: Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" master "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" send event\n                  Master_Host: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".2")]),s._v("\n                  Master_User: slave\n                  Master_Port: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n                Connect_Retry: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n              Master_Log_File: master"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v("\n          Read_Master_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("996")]),s._v("\n               Relay_Log_File: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v("fb0493866"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("relay"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000002")]),s._v("\n                Relay_Log_Pos: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("325")]),s._v("\n        Relay_Master_Log_File: master"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v("\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n")])])]),t("p",[s._v("退出容器。")]),s._v(" "),t("h2",{attrs:{id:"实验测试结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实验测试结果"}},[s._v("#")]),s._v(" 实验测试结果")]),s._v(" "),t("p",[s._v("测试过程准备如下：在主库中创建test库，然后查看从库中是否会同步test库。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入主库之中")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 03b4cbdd57a6 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入数据库内部")]),s._v("\nmysql -uroot -p123456\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建test库")]),s._v("\ncreate database "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入从库之中")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it -e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("LANG")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("C.UTF-8 120fb0493866 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入数据库内部")]),s._v("\nmysql -uroot -p123456\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看所有的数据库列表")]),s._v("\nshow databases"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("查看到从库中确实也有了test库，说明主从复制成功。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[s._v("mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("databases")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Database")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql              "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sys                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" test               "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n")])])]),t("h2",{attrs:{id:"遇到的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[s._v("#")]),s._v(" 遇到的问题")]),s._v(" "),t("h3",{attrs:{id:"修改了配置文件未生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改了配置文件未生效"}},[s._v("#")]),s._v(" 修改了配置文件未生效")]),s._v(" "),t("p",[s._v("每次修改完MySQL的配置文件，应该将数据库重启，因为在docker中我不知道该怎么同步，所以最后用重启docker的形式代替。")]),s._v(" "),t("h3",{attrs:{id:"字符集问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字符集问题"}},[s._v("#")]),s._v(" 字符集问题")]),s._v(" "),t("p",[s._v("在进入容器的时候，我手动将字符集设置为UTF-8，是因为在此前我在数据库中插入中文数据的时候显示空白。")]),s._v(" "),t("h3",{attrs:{id:"密码过于简单报错"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#密码过于简单报错"}},[s._v("#")]),s._v(" 密码过于简单报错")]),s._v(" "),t("p",[s._v("这也是我最明显能体会到5版本和8版本的区别，当用户的密码设置过于简单的时候，就会报出mysql_native_password错误，解决办法是执行下面这条命令。")]),s._v(" "),t("div",{staticClass:"language-sql extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("alter")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'slave'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),s._v(" identified "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" mysql_native_password "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("by")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'123456'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"展望"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#展望"}},[s._v("#")]),s._v(" 展望")]),s._v(" "),t("p",[s._v("未来需要了解，例如为什么要使用读写分离，如何保证数据的一致性，主从复制的延迟有多久，为什么能做到主从复制，使用了什么协议。")]),s._v(" "),t("h2",{attrs:{id:"参考文章列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文章列表"}},[s._v("#")]),s._v(" 参考文章列表")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://juejin.cn/post/6844903921677238285",target:"_blank",rel:"noopener noreferrer"}},[s._v("Mysql主从复制原理及搭建"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/m290345792/article/details/88316962",target:"_blank",rel:"noopener noreferrer"}},[s._v("authentication plugin 'caching_sha2_password' 问题解决"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/gu_wen_jie/article/details/102721524",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL-基于docker实现Replication集群主从复制及读写分离"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.cnblogs.com/mafeng/p/10237692.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("docker查看容器的网络ip"),t("OutboundLink")],1)]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.jb51.net/article/197042.htm",target:"_blank",rel:"noopener noreferrer"}},[s._v("MySQL8.0中binlog的深入讲解"),t("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);